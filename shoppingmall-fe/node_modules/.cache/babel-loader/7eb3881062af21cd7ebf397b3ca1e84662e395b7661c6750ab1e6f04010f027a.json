{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\shoppingmall\\\\shoppingmall-fe\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$();\nimport api from \"../api/apiClient\";\nimport { createContext, useReducer, useEffect, useState, useContext } from \"react\";\nimport { AuthContext } from \"./AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CartContext = /*#__PURE__*/createContext();\nconst initialState = {\n  cartItems: []\n};\nconst cartReducer = (state, action) => {\n  switch (action.type) {\n    case \"SET_CART\":\n      return {\n        ...state,\n        cartItems: action.payload\n      };\n    case \"ADD_ITEM\":\n      const exist = state.cartItems.find(item => item.id === action.payload.id);\n      if (exist) {\n        return {\n          // 이미 카트에 존재하는 상품은 수량만 update\n          ...state,\n          cartItems: state.cartItems.map(item => item.id === action.payload.id ? {\n            ...item,\n            quantity: item.quantity + action.payload.quantity\n          } : item)\n        };\n      } else {\n        return {\n          // 카트에 없으면 추가\n          ...state,\n          cartItems: [...state.cartItems, action.payload]\n        };\n      }\n    case \"UPDATE_ITEM\":\n      // 장바구니에서 직접 수량 변경 시 사용 (이미 존재하는 상품 수량 update)\n      return {\n        ...state,\n        cartItems: state.cartItems.map(item => item.id === action.payload.id ? {\n          ...item,\n          quantity: action.payload.quantity\n        } : item)\n      };\n    case \"REMOVE_ITEM\":\n      return {\n        ...state,\n        cartItems: state.cartItems.filter(item => item.id !== action.payload.id)\n      };\n    case \"CLEAR_CART\":\n      return {\n        ...state,\n        cartItems: []\n      };\n    default:\n      return state;\n  }\n};\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const [cartState, dispatch] = useReducer(cartReducer, initialState);\n  const {\n    userInfo\n  } = useContext(AuthContext);\n  const [initialized, setInitialized] = useState(false);\n\n  // 최초 렌더링 시 localStorage에서 불러오기 (비회원)\n  useEffect(() => {\n    if (!userInfo.token) {\n      const localItems = JSON.parse(localStorage.getItem(\"cartItems\")) || [];\n      dispatch({\n        type: \"SET_CART\",\n        payload: localItems\n      });\n    }\n    setInitialized(true);\n  }, [userInfo.token]);\n\n  // 비회원일 때는 localStorage에 저장\n  useEffect(() => {\n    if (!userInfo.token && initialized) {\n      localStorage.setItem(\"cartItems\", JSON.stringify(cartState.cartItems));\n    }\n  }, [cartState.cartItems, userInfo.token, initialized]);\n\n  // 로그인 시 서버 장바구니 병합\n  useEffect(() => {\n    const mergeCart = async () => {\n      try {\n        const localItems = JSON.parse(localStorage.getItem(\"cartItems\")) || [];\n        const response = await api.get('/cart');\n        const serverItems = response.data();\n\n        // 병합 로직\n        const mergedItems = [...serverItems];\n        localItems.forEach(localItem => {\n          const index = mergedItems.findIndex(item => item.id === localItem.id);\n          if (index !== -1) {\n            // 기존 항목이 있는 경우: 해당 인덱스를 직접 수정a\n            mergedItems[index] = {\n              ...mergedItems[index],\n              quantity: mergedItems[index].quantity + localItem.quantity\n            };\n          } else {\n            // 없는 경우: 새 항목 추가\n            mergedItems.push({\n              ...localItem\n            });\n          }\n        });\n\n        //병합된 장바구니 서버에 저장\n        await api.post('/cart', mergedItems);\n\n        // 병합 후 서버에서 최신 장바구니 다시 조회\n        const updated = await api.get('/cart');\n        dispatch({\n          type: \"SET_CART\",\n          payload: updated.data\n        });\n\n        // localStorage 초기화\n        localStorage.removeItem(\"cartItems\");\n      } catch (error) {\n        console.error(\"장바구니 병합 실패:\", error);\n      }\n    };\n    if (userInfo.token) {\n      mergeCart();\n    }\n  }, [userInfo.token]);\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      cartState,\n      dispatch\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n};\n_s(CartProvider, \"6bC3+bej1ATaP3nGv2qXgyEJBJo=\");\n_c = CartProvider;\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["api","createContext","useReducer","useEffect","useState","useContext","AuthContext","jsxDEV","_jsxDEV","CartContext","initialState","cartItems","cartReducer","state","action","type","payload","exist","find","item","id","map","quantity","filter","CartProvider","children","_s","cartState","dispatch","userInfo","initialized","setInitialized","token","localItems","JSON","parse","localStorage","getItem","setItem","stringify","mergeCart","response","get","serverItems","data","mergedItems","forEach","localItem","index","findIndex","push","post","updated","removeItem","error","console","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/project/shoppingmall/shoppingmall-fe/src/context/CartContext.js"],"sourcesContent":["import api from \"../api/apiClient\";\r\nimport { createContext, useReducer, useEffect, useState, useContext } from \"react\";\r\nimport { AuthContext } from \"./AuthContext\";\r\n\r\nexport const CartContext = createContext();\r\n\r\nconst initialState = {\r\n  cartItems: []\r\n};\r\n\r\nconst cartReducer = (state, action) => {\r\n  switch (action.type) {\r\n\r\n    case \"SET_CART\":\r\n      return { ...state, cartItems: action.payload };\r\n\r\n    case \"ADD_ITEM\":\r\n      const exist = state.cartItems.find(item => item.id === action.payload.id);\r\n      if (exist) {\r\n        return { // 이미 카트에 존재하는 상품은 수량만 update\r\n          ...state,\r\n          cartItems: state.cartItems.map(item =>\r\n            item.id === action.payload.id\r\n              ? { ...item, quantity: item.quantity + action.payload.quantity }\r\n              : item\r\n          )\r\n        };\r\n      } else {\r\n        return { // 카트에 없으면 추가\r\n          ...state,\r\n          cartItems: [...state.cartItems, action.payload]\r\n        };\r\n      }\r\n\r\n    case \"UPDATE_ITEM\": // 장바구니에서 직접 수량 변경 시 사용 (이미 존재하는 상품 수량 update)\r\n      return {\r\n        ...state,\r\n        cartItems: state.cartItems.map(item =>\r\n          item.id === action.payload.id\r\n            ? { ...item, quantity: action.payload.quantity }\r\n            : item\r\n        )\r\n      };\r\n\r\n    case \"REMOVE_ITEM\":\r\n      return {\r\n        ...state,\r\n        cartItems: state.cartItems.filter(item => item.id !== action.payload.id)\r\n      };\r\n\r\n    case \"CLEAR_CART\":\r\n      return { ...state, cartItems: [] };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  const [cartState, dispatch] = useReducer(cartReducer, initialState);\r\n  const { userInfo } = useContext(AuthContext);\r\n  const [initialized, setInitialized] = useState(false);\r\n\r\n  // 최초 렌더링 시 localStorage에서 불러오기 (비회원)\r\n  useEffect(() => {\r\n    if (!userInfo.token) {\r\n      const localItems = JSON.parse(localStorage.getItem(\"cartItems\")) || [];\r\n      dispatch({ type: \"SET_CART\", payload: localItems });\r\n    }\r\n    setInitialized(true);\r\n  }, [userInfo.token]);\r\n\r\n  // 비회원일 때는 localStorage에 저장\r\n  useEffect(() => {\r\n    if(!userInfo.token && initialized) {\r\n      localStorage.setItem(\"cartItems\", JSON.stringify(cartState.cartItems));\r\n    }\r\n  }, [cartState.cartItems, userInfo.token, initialized]);\r\n\r\n  // 로그인 시 서버 장바구니 병합\r\n  useEffect(() => {\r\n    const mergeCart = async () => {\r\n\r\n      try{\r\n        const localItems = JSON.parse(localStorage.getItem(\"cartItems\")) || [];\r\n\r\n        const response = await api.get('/cart');\r\n        const serverItems = response.data();\r\n\r\n        // 병합 로직\r\n        const mergedItems = [...serverItems];\r\n        localItems.forEach(localItem => {\r\n          const index = mergedItems.findIndex(item => item.id === localItem.id);\r\n          if (index !== -1) {\r\n            // 기존 항목이 있는 경우: 해당 인덱스를 직접 수정a\r\n            mergedItems[index] = {\r\n              ...mergedItems[index],\r\n              quantity: mergedItems[index].quantity + localItem.quantity\r\n            };\r\n          } else {\r\n            // 없는 경우: 새 항목 추가\r\n            mergedItems.push({ ...localItem });\r\n          }\r\n        });\r\n\r\n        //병합된 장바구니 서버에 저장\r\n        await api.post('/cart', mergedItems)\r\n\r\n        // 병합 후 서버에서 최신 장바구니 다시 조회\r\n        const updated = await api.get('/cart');\r\n        dispatch({ type: \"SET_CART\", payload: updated.data });\r\n\r\n        // localStorage 초기화\r\n        localStorage.removeItem(\"cartItems\");\r\n      } catch (error) {\r\n        console.error(\"장바구니 병합 실패:\", error);\r\n      }\r\n    };\r\n\r\n    if (userInfo.token) {\r\n      mergeCart();\r\n    }\r\n  }, [userInfo.token]);\r\n\r\n  return (\r\n    <CartContext.Provider value={{ cartState, dispatch }}>\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}